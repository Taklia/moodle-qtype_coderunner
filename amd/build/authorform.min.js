define(["jquery"],function(a){function b(){a().ready(c)}function c(){function b(b){var c=n.prop("value").toLowerCase(),d=a("#id_"+b).is(":visible")||a("#id_"+b+"_wrapper").is(":visible");m.prop("checked")&&d&&require(["qtype_coderunner/aceinterface"],function(a){a.initAce("id_"+b,c)})}function c(a){var c=a?"block":"none";p.css("display",c),q.css("display",c),a&&b("template")}function e(b,e){var f,h,i;for(var j in d)f=d[j],h=e[j]?e[j]:f[2],f.length>3&&(i=f[3],h=i(h)),a(f[0]).prop(f[1],h);t.prop("value",b),o.prop("checked",!1),v.html(g(b,e.questiontext)),c(!1)}function f(a,b){var c;window.alert(h("prototype_load_failure")+b),c=h("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+u+", qtype: "+a,l.prop("value",c)}function g(a,b){var c='<p class="question-type-details-header">';return c+=h("coderunner_question_type"),c+=a+"</p>\n"+b}function h(a){return M.util.get_string(a,"qtype_coderunner")}function i(){var b=k.children("option:selected").text();""!==b&&"Undefined"!==b&&(k.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:u,sesskey:M.cfg.sesskey},function(a){a.success?e(b,a):f(b,a.error)}).error(function(){window.alert(h("error_loading_prototype")),l.prop("value",h("ajax_error"))}))}function j(){"3"===w.val()?x.show():x.hide()}var k=a("#id_coderunnertype"),l=a("#id_template"),m=a("#id_useace"),n=a("#id_language"),o=a("#id_customise"),p=a("#id_customisationheader"),q=a("#id_advancedcustomisationheader"),r=o.prop("checked"),s=a("#id_prototypetype"),t=a("#id_typename"),u=a('input[name="courseid"]').prop("value"),v=a("#qtype-help"),w=a("select#id_precheck"),x=a("div[id^=fitem_id_testtype]");1==s.prop("value")&&(window.alert(h("proceed_at_own_risk")),s.prop("disabled",!0),k.prop("disabled",!0),o.prop("disabled",!0)),b("answer"),c(r),r?v.html("<p>"+h("info_unavailable")+"</p>"):i(),j(),o.on("change",function(){var a=o.prop("checked");a?c(!0):window.confirm(h("confirm_proceed"))?c(!1):o.prop("checked",!0)}),k.on("change",function(){o.prop("checked")&&!window.confirm(h("question_type_changed"))||i()}),m.on("change",function(){var a=m.prop("checked");a?(b("template"),b("answer")):require(["qtype_coderunner/aceinterface"],function(a){a.stopUsingAce()})}),w.on("change",j)}var d={template:["#id_template","value",""],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],language:["#id_language","value",""]};return{initEditForm:b}});